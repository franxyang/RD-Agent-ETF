# RD-Agent ETFå› å­æŒ–æ˜ç³»ç»Ÿ - æœ¬åœ°éƒ¨ç½²å®Œå…¨æŒ‡å—

> ğŸ“– ç‰ˆæœ¬ï¼š1.0.0 | æ›´æ–°æ—¥æœŸï¼š2025-08-08  
> ğŸ’¡ æœ¬æŒ‡å—é’ˆå¯¹RD-Agent 0.7.0ç‰ˆæœ¬ï¼Œæä¾›ä»é›¶å¼€å§‹çš„å®Œæ•´éƒ¨ç½²æ•™ç¨‹

## ğŸ¯ ç¬¬ä¸€éƒ¨åˆ†ï¼šç³»ç»Ÿæ¦‚è¿°

### ä»€ä¹ˆæ˜¯RD-Agentï¼Ÿ

RD-Agentæ˜¯å¾®è½¯å¼€æºçš„**è‡ªåŠ¨åŒ–é‡åŒ–ç ”ç©¶ç³»ç»Ÿ**ï¼Œé€šè¿‡AIé©±åŠ¨çš„æ–¹å¼è‡ªåŠ¨è¿›è¡Œå› å­æŒ–æ˜å’Œæ¨¡å‹ä¼˜åŒ–ã€‚æœ¬é¡¹ç›®å°†å…¶åº”ç”¨äº**ETFå¸‚åœº**ï¼Œå®ç°è‡ªåŠ¨åŒ–çš„Alphaå› å­å‘ç°ã€‚

### æ ¸å¿ƒä»·å€¼
- ğŸ¤– **è‡ªåŠ¨åŒ–å› å­ç”Ÿæˆ**ï¼šAIè‡ªåŠ¨è®¾è®¡å’Œå®ç°æ–°çš„é‡åŒ–å› å­
- ğŸ“Š **æ™ºèƒ½å›æµ‹è¯„ä¼°**ï¼šè‡ªåŠ¨è¿›è¡Œå†å²å›æµ‹å¹¶è®¡ç®—ICå€¼
- ğŸ”„ **è¿›åŒ–ä¼˜åŒ–**ï¼šåŸºäºåé¦ˆæŒç»­æ”¹è¿›å› å­è´¨é‡
- ğŸ’° **æˆæœ¬æ•ˆç›Š**ï¼šä¸åˆ°10ç¾å…ƒå³å¯è·å¾—2å€äºåŸºå‡†çš„æ”¶ç›Šç‡

### ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·è¾“å…¥å‘½ä»¤                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              RD-Agent æ ¸å¿ƒå¼•æ“                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Research â”‚â†’ â”‚ Develop  â”‚â†’ â”‚ Evaluate â”‚          â”‚
â”‚  â”‚  Agent   â”‚  â”‚  Agent   â”‚  â”‚  Agent   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ•°æ®å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ ETFæ•°æ®  â”‚  â”‚ å› å­åº“   â”‚  â”‚ å›æµ‹ç»“æœ â”‚          â”‚
â”‚  â”‚ (.bin)   â”‚  â”‚ (.pkl)   â”‚  â”‚ (.csv)   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å·¥ä½œæµç¨‹

1. **å› å­å‡è®¾ç”Ÿæˆ** â†’ LLMç”Ÿæˆå› å­è®¾è®¡æ€è·¯
2. **ä»£ç å®ç°** â†’ è‡ªåŠ¨ç¼–å†™factor.pyå®ç°ä»£ç   
3. **æ•°æ®å¤„ç†** â†’ è¯»å–ETFæ•°æ®è®¡ç®—å› å­å€¼
4. **å›æµ‹è¯„ä¼°** â†’ Qlibæ‰§è¡Œå›æµ‹è®¡ç®—ICå€¼
5. **è¿›åŒ–è¿­ä»£** â†’ åŸºäºç»“æœä¼˜åŒ–å› å­

---

## ğŸ“‹ ç¬¬äºŒéƒ¨åˆ†ï¼šç¯å¢ƒå‡†å¤‡

### ç³»ç»Ÿè¦æ±‚

| ç»„ä»¶ | æœ€ä½è¦æ±‚ | æ¨èé…ç½® |
|------|---------|---------|
| æ“ä½œç³»ç»Ÿ | macOS 12+ / Windows 10+ / Ubuntu 20.04+ | macOS 14+ / Windows 11 |
| CPU | 4æ ¸ | 8æ ¸+ |
| å†…å­˜ | 8GB | 16GB+ |
| ç¡¬ç›˜ç©ºé—´ | 20GB | 50GB+ |
| Python | 3.10.x | 3.10.18 |
| Docker | 20.10+ | æœ€æ–°ç‰ˆ |

### å‰ç½®è½¯ä»¶æ£€æŸ¥

åˆ›å»ºæ£€æŸ¥è„šæœ¬ `check_environment.sh`ï¼š

```bash
#!/bin/bash

echo "========================================="
echo "   RD-Agent ç¯å¢ƒæ£€æŸ¥å·¥å…· v1.0"
echo "========================================="

# é¢œè‰²å®šä¹‰
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# æ£€æŸ¥å‡½æ•°
check_command() {
    if command -v $1 &> /dev/null; then
        echo -e "${GREEN}âœ“${NC} $2 å·²å®‰è£…: $(command -v $1)"
        if [ ! -z "$3" ]; then
            version=$($3)
            echo "  ç‰ˆæœ¬: $version"
        fi
        return 0
    else
        echo -e "${RED}âœ—${NC} $2 æœªå®‰è£…"
        return 1
    fi
}

echo ""
echo "1. æ£€æŸ¥åŸºç¡€ç¯å¢ƒ..."
echo "-----------------"

# Pythonæ£€æŸ¥
check_command python3 "Python 3" "python3 --version"
if [ $? -eq 0 ]; then
    python_version=$(python3 -c 'import sys; print(".".join(map(str, sys.version_info[:2])))')
    if [[ "$python_version" == "3.10" ]] || [[ "$python_version" == "3.11" ]]; then
        echo -e "  ${GREEN}Pythonç‰ˆæœ¬ç¬¦åˆè¦æ±‚${NC}"
    else
        echo -e "  ${YELLOW}è­¦å‘Š: æ¨èä½¿ç”¨Python 3.10æˆ–3.11${NC}"
    fi
fi

# Condaæ£€æŸ¥
check_command conda "Conda" "conda --version"

# Gitæ£€æŸ¥
check_command git "Git" "git --version"

# Dockeræ£€æŸ¥
check_command docker "Docker" "docker --version"
if [ $? -eq 0 ]; then
    if docker run --rm hello-world &> /dev/null; then
        echo -e "  ${GREEN}Dockerè¿è¡Œæ­£å¸¸${NC}"
    else
        echo -e "  ${YELLOW}è­¦å‘Š: Dockeréœ€è¦sudoæƒé™æˆ–æœªæ­£ç¡®é…ç½®${NC}"
    fi
fi

echo ""
echo "2. æ£€æŸ¥ç£ç›˜ç©ºé—´..."
echo "-----------------"

# macOSå’ŒLinuxé€šç”¨ç£ç›˜æ£€æŸ¥
available_space=$(df -h . | awk 'NR==2 {print $4}')
echo "å½“å‰ç›®å½•å¯ç”¨ç©ºé—´: $available_space"

# æå–æ•°å­—éƒ¨åˆ†è¿›è¡Œæ¯”è¾ƒ
space_num=$(echo $available_space | sed 's/[^0-9.]//g')
space_unit=$(echo $available_space | sed 's/[0-9.]//g')

if [[ "$space_unit" == "G" || "$space_unit" == "Gi" ]]; then
    if (( $(echo "$space_num > 20" | bc -l) )); then
        echo -e "${GREEN}ç£ç›˜ç©ºé—´å……è¶³${NC}"
    else
        echo -e "${YELLOW}è­¦å‘Š: å»ºè®®è‡³å°‘ä¿ç•™20GBå¯ç”¨ç©ºé—´${NC}"
    fi
elif [[ "$space_unit" == "T" || "$space_unit" == "Ti" ]]; then
    echo -e "${GREEN}ç£ç›˜ç©ºé—´å……è¶³${NC}"
else
    echo -e "${RED}ç£ç›˜ç©ºé—´å¯èƒ½ä¸è¶³${NC}"
fi

echo ""
echo "3. æ“ä½œç³»ç»Ÿç‰¹å®šæ£€æŸ¥..."
echo "---------------------"

# æ£€æµ‹æ“ä½œç³»ç»Ÿ
if [[ "$OSTYPE" == "darwin"* ]]; then
    echo "æ£€æµ‹åˆ° macOS ç³»ç»Ÿ"
    
    # æ£€æŸ¥Homebrew
    check_command brew "Homebrew" "brew --version"
    
    # æ£€æŸ¥Xcodeå‘½ä»¤è¡Œå·¥å…·
    if xcode-select -p &> /dev/null; then
        echo -e "${GREEN}âœ“${NC} Xcodeå‘½ä»¤è¡Œå·¥å…·å·²å®‰è£…"
    else
        echo -e "${YELLOW}âš ${NC} éœ€è¦å®‰è£…Xcodeå‘½ä»¤è¡Œå·¥å…·: xcode-select --install"
    fi
    
    # æ£€æŸ¥coreutilsï¼ˆåŒ…å«gtimeoutï¼‰
    if command -v gtimeout &> /dev/null; then
        echo -e "${GREEN}âœ“${NC} GNU coreutilså·²å®‰è£…ï¼ˆåŒ…å«timeoutå‘½ä»¤ï¼‰"
    else
        echo -e "${YELLOW}âš ${NC} å»ºè®®å®‰è£…coreutils: brew install coreutils"
    fi
    
elif [[ "$OSTYPE" == "linux-gnu"* ]]; then
    echo "æ£€æµ‹åˆ° Linux ç³»ç»Ÿ"
    check_command timeout "timeoutå‘½ä»¤" "timeout --version | head -n1"
    
elif [[ "$OSTYPE" == "msys" ]] || [[ "$OSTYPE" == "cygwin" ]] || [[ "$OSTYPE" == "win32" ]]; then
    echo "æ£€æµ‹åˆ° Windows ç³»ç»Ÿ"
    echo -e "${YELLOW}æç¤º: å»ºè®®ä½¿ç”¨WSL2æˆ–Docker Desktop${NC}"
fi

echo ""
echo "========================================="
echo "æ£€æŸ¥å®Œæˆï¼"
echo ""
echo "ä¸‹ä¸€æ­¥æ“ä½œï¼š"
echo "1. ä¿®å¤æ‰€æœ‰æ ‡è®°ä¸º âœ— çš„é¡¹ç›®"
echo "2. è€ƒè™‘å®‰è£…æ ‡è®°ä¸º âš  çš„æ¨èé¡¹"
echo "3. è¿è¡Œ 'bash quick_install.sh' å¼€å§‹å®‰è£…"
echo "========================================="
```

---

## ğŸš€ ç¬¬ä¸‰éƒ¨åˆ†ï¼šå¿«é€Ÿå®‰è£…

### é€‰é¡¹1ï¼šä¸€é”®å®‰è£…è„šæœ¬ï¼ˆæ¨èï¼‰

åˆ›å»º `quick_install.sh`ï¼š

```bash
#!/bin/bash

set -e  # é‡åˆ°é”™è¯¯ç«‹å³é€€å‡º

echo "========================================="
echo "   RD-Agent ETF ä¸€é”®å®‰è£…è„šæœ¬"
echo "========================================="

# 1. å…‹éš†é¡¹ç›®
echo "ğŸ“¦ æ­¥éª¤1: å…‹éš†RD-Agenté¡¹ç›®..."
if [ ! -d "RD-Agent" ]; then
    git clone https://github.com/microsoft/RD-Agent.git
fi
cd RD-Agent

# 2. åˆ›å»ºPythonç¯å¢ƒ
echo "ğŸ æ­¥éª¤2: åˆ›å»ºPythonç¯å¢ƒ..."
conda create -n rdagent python=3.10.18 -y
source $(conda info --base)/etc/profile.d/conda.sh
conda activate rdagent

# 3. å®‰è£…ä¾èµ–
echo "ğŸ“š æ­¥éª¤3: å®‰è£…Pythonä¾èµ–..."
pip install -e .
pip install qlib

# 4. ä¸‹è½½ç¤ºä¾‹æ•°æ®
echo "ğŸ“Š æ­¥éª¤4: å‡†å¤‡ETFç¤ºä¾‹æ•°æ®..."
mkdir -p data
cd data

# ä¸‹è½½é¢„å¤„ç†çš„ETFç¤ºä¾‹æ•°æ®ï¼ˆè¿™é‡Œéœ€è¦æ‚¨æä¾›æ•°æ®URLï¼‰
# wget https://your-data-url/etf_sample_data.tar.gz
# tar -xzf etf_sample_data.tar.gz

echo "ç¤ºä¾‹æ•°æ®å‡†å¤‡å®Œæˆ"
cd ..

# 5. åº”ç”¨å¿…è¦çš„è¡¥ä¸
echo "ğŸ”§ æ­¥éª¤5: åº”ç”¨ç³»ç»Ÿå…¼å®¹æ€§è¡¥ä¸..."

# macOSå…¼å®¹æ€§ä¿®å¤
if [[ "$OSTYPE" == "darwin"* ]]; then
    echo "æ£€æµ‹åˆ°macOSï¼Œåº”ç”¨å…¼å®¹æ€§è¡¥ä¸..."
    
    # ä¿®å¤timeoutå‘½ä»¤é—®é¢˜
    python << 'EOF'
import fileinput
import sys

file_path = "rdagent/utils/env.py"
for line in fileinput.input(file_path, inplace=True):
    if "timeout --kill-after" in line and "entry_add_timeout" in line:
        print('        entry_add_timeout = f"/bin/sh -c \'if command -v timeout >/dev/null 2>&1; then timeout --kill-after=10 {self.conf.running_timeout_period} {entry}; else {entry}; fi; entry_exit_code=$?; exit $entry_exit_code\'"')
    else:
        print(line, end='')
EOF
    echo "macOSè¡¥ä¸åº”ç”¨å®Œæˆ"
fi

# 6. é…ç½®æ–‡ä»¶ç”Ÿæˆ
echo "âš™ï¸ æ­¥éª¤6: ç”Ÿæˆé…ç½®æ–‡ä»¶..."
python << 'EOF'
import os
import yaml

# åˆ›å»º.envæ–‡ä»¶
env_content = """
# LLMé…ç½®
CHAT_MODEL=gpt-4o
EMBEDDING_MODEL=text-embedding-3-small
OPENAI_API_KEY=your_api_key_here
OPENAI_API_BASE=https://api.openai.com/v1

# æ•°æ®è·¯å¾„é…ç½®
QLIB_DATA_PATH={}/data/qlib_etf_data_final
HDF5_DATA_PATH={}/data/qlib_etf_data_h5
""".format(os.getcwd(), os.getcwd())

with open('.env', 'w') as f:
    f.write(env_content)

print("é…ç½®æ–‡ä»¶å·²ç”Ÿæˆ")
print("âš ï¸ è¯·ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥æ‚¨çš„OpenAI APIå¯†é’¥")
EOF

# 7. éªŒè¯å®‰è£…
echo "âœ… æ­¥éª¤7: éªŒè¯å®‰è£…..."
python -c "import rdagent; print('RD-Agentç‰ˆæœ¬:', rdagent.__version__)"
python -c "import qlib; print('Qlibå¯¼å…¥æˆåŠŸ')"

echo ""
echo "========================================="
echo "ğŸ‰ å®‰è£…å®Œæˆï¼"
echo ""
echo "ä¸‹ä¸€æ­¥æ“ä½œï¼š"
echo "1. ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®APIå¯†é’¥"
echo "2. å‡†å¤‡ETFæ•°æ®ï¼ˆå‚è§æ•°æ®å‡†å¤‡ç« èŠ‚ï¼‰"
echo "3. è¿è¡Œæµ‹è¯•: rdagent health_check"
echo "========================================="
```

### é€‰é¡¹2ï¼šDockerå®‰è£…ï¼ˆæœ€ç®€å•ï¼‰

åˆ›å»º `Dockerfile`ï¼š

```dockerfile
FROM python:3.10-slim

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \
    git \
    wget \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å…‹éš†RD-Agent
RUN git clone https://github.com/microsoft/RD-Agent.git .

# å®‰è£…Pythonä¾èµ–
RUN pip install --no-cache-dir -e .
RUN pip install --no-cache-dir qlib

# å¤åˆ¶é…ç½®æ–‡ä»¶
COPY config/ ./config/
COPY data/ ./data/

# è®¾ç½®ç¯å¢ƒå˜é‡
ENV PYTHONPATH=/app

# æš´éœ²ç«¯å£ï¼ˆç”¨äºWeb UIï¼‰
EXPOSE 19899

# å¯åŠ¨å‘½ä»¤
CMD ["bash"]
```

ä½¿ç”¨Dockerï¼š
```bash
# æ„å»ºé•œåƒ
docker build -t rdagent-etf:latest .

# è¿è¡Œå®¹å™¨
docker run -it \
    -v $(pwd)/data:/app/data \
    -v $(pwd)/config:/app/config \
    -p 19899:19899 \
    rdagent-etf:latest
```

---

## ğŸ“Š ç¬¬å››éƒ¨åˆ†ï¼šæ•°æ®å‡†å¤‡

### ETFæ•°æ®æ ¼å¼è¦æ±‚

æ‚¨çš„CSVæ•°æ®éœ€è¦åŒ…å«ä»¥ä¸‹å­—æ®µï¼š

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|
| datetime | str | æ—¥æœŸ | 2025-01-01 |
| instrument | str | ETFä»£ç  | 510300.SH |
| open | float | å¼€ç›˜ä»· | 4.123 |
| high | float | æœ€é«˜ä»· | 4.156 |
| low | float | æœ€ä½ä»· | 4.098 |
| close | float | æ”¶ç›˜ä»· | 4.145 |
| volume | float | æˆäº¤é‡ | 1234567 |

### æ•°æ®è½¬æ¢è„šæœ¬

åˆ›å»º `prepare_etf_data.py`ï¼š

```python
#!/usr/bin/env python
"""
ETFæ•°æ®å‡†å¤‡å·¥å…·
å°†CSVæ ¼å¼çš„ETFæ•°æ®è½¬æ¢ä¸ºRD-Agentæ‰€éœ€çš„æ ¼å¼
"""

import os
import sys
import pandas as pd
import numpy as np
from pathlib import Path
import subprocess
from tqdm import tqdm

class ETFDataPreparer:
    def __init__(self, input_path, output_dir):
        self.input_path = Path(input_path)
        self.output_dir = Path(output_dir)
        self.qlib_dir = self.output_dir / "qlib_etf_data_final"
        self.h5_dir = self.output_dir / "qlib_etf_data_h5"
        
    def prepare(self):
        """å®Œæ•´çš„æ•°æ®å‡†å¤‡æµç¨‹"""
        print("ğŸ“Š ETFæ•°æ®å‡†å¤‡å¼€å§‹...")
        
        # 1. è¯»å–åŸå§‹æ•°æ®
        print("1ï¸âƒ£ è¯»å–CSVæ•°æ®...")
        df = self.read_csv_data()
        
        # 2. æ•°æ®éªŒè¯
        print("2ï¸âƒ£ éªŒè¯æ•°æ®æ ¼å¼...")
        self.validate_data(df)
        
        # 3. è½¬æ¢ä¸ºQlibæ ¼å¼
        print("3ï¸âƒ£ è½¬æ¢ä¸ºQlibæ ¼å¼...")
        self.convert_to_qlib(df)
        
        # 4. ç”ŸæˆHDF5æ ¼å¼
        print("4ï¸âƒ£ ç”ŸæˆHDF5æ ¼å¼...")
        self.create_hdf5(df)
        
        # 5. éªŒè¯ç»“æœ
        print("5ï¸âƒ£ éªŒè¯è½¬æ¢ç»“æœ...")
        self.verify_conversion()
        
        print("âœ… æ•°æ®å‡†å¤‡å®Œæˆï¼")
        
    def read_csv_data(self):
        """è¯»å–CSVæ•°æ®"""
        if self.input_path.is_file():
            df = pd.read_csv(self.input_path)
        else:
            # è¯»å–ç›®å½•ä¸‹æ‰€æœ‰CSVæ–‡ä»¶
            all_dfs = []
            for csv_file in self.input_path.glob("*.csv"):
                df = pd.read_csv(csv_file)
                all_dfs.append(df)
            df = pd.concat(all_dfs, ignore_index=True)
        
        print(f"  è¯»å– {len(df)} æ¡è®°å½•")
        print(f"  æ—¶é—´èŒƒå›´: {df['datetime'].min()} è‡³ {df['datetime'].max()}")
        print(f"  ETFæ•°é‡: {df['instrument'].nunique()}")
        
        return df
    
    def validate_data(self, df):
        """éªŒè¯æ•°æ®æ ¼å¼"""
        required_columns = ['datetime', 'instrument', 'open', 'high', 'low', 'close', 'volume']
        
        # æ£€æŸ¥å¿…éœ€åˆ—
        missing_cols = set(required_columns) - set(df.columns)
        if missing_cols:
            raise ValueError(f"ç¼ºå°‘å¿…éœ€åˆ—: {missing_cols}")
        
        # æ£€æŸ¥æ•°æ®ç±»å‹
        df['datetime'] = pd.to_datetime(df['datetime'])
        for col in ['open', 'high', 'low', 'close', 'volume']:
            df[col] = pd.to_numeric(df[col], errors='coerce')
        
        # æ£€æŸ¥ç¼ºå¤±å€¼
        null_counts = df[required_columns].isnull().sum()
        if null_counts.any():
            print(f"  âš ï¸ è­¦å‘Š: å‘ç°ç¼ºå¤±å€¼")
            print(null_counts[null_counts > 0])
        
        return True
    
    def convert_to_qlib(self, df):
        """è½¬æ¢ä¸ºQlib binæ ¼å¼"""
        # åˆ›å»ºç›®å½•ç»“æ„
        self.qlib_dir.mkdir(parents=True, exist_ok=True)
        calendars_dir = self.qlib_dir / "calendars"
        features_dir = self.qlib_dir / "features"
        instruments_dir = self.qlib_dir / "instruments"
        
        calendars_dir.mkdir(exist_ok=True)
        features_dir.mkdir(exist_ok=True)
        instruments_dir.mkdir(exist_ok=True)
        
        # 1. ç”Ÿæˆæ—¥å†æ–‡ä»¶
        calendars = sorted(df['datetime'].unique())
        calendars_file = calendars_dir / "day.txt"
        pd.DataFrame(calendars).to_csv(calendars_file, index=False, header=False)
        print(f"  ç”Ÿæˆæ—¥å†æ–‡ä»¶: {len(calendars)} ä¸ªäº¤æ˜“æ—¥")
        
        # 2. ç”Ÿæˆè‚¡ç¥¨åˆ—è¡¨æ–‡ä»¶
        instruments = []
        for instrument in df['instrument'].unique():
            inst_df = df[df['instrument'] == instrument]
            start_date = inst_df['datetime'].min()
            end_date = inst_df['datetime'].max()
            instruments.append(f"{instrument}\t{start_date}\t{end_date}")
        
        instruments_file = instruments_dir / "all.txt"
        with open(instruments_file, 'w') as f:
            f.write('\n'.join(instruments))
        print(f"  ç”Ÿæˆè‚¡ç¥¨åˆ—è¡¨: {len(instruments)} ä¸ªETF")
        
        # 3. ä¸ºæ¯ä¸ªè‚¡ç¥¨ç”Ÿæˆç‰¹å¾æ–‡ä»¶
        for instrument in tqdm(df['instrument'].unique(), desc="  è½¬æ¢è‚¡ç¥¨æ•°æ®"):
            inst_df = df[df['instrument'] == instrument].sort_values('datetime')
            inst_dir = features_dir / instrument.lower()
            inst_dir.mkdir(exist_ok=True)
            
            # ä¸ºæ¯ä¸ªç‰¹å¾ç”Ÿæˆbinæ–‡ä»¶
            for feature in ['open', 'high', 'low', 'close', 'volume']:
                self._save_bin_file(
                    inst_df['datetime'].values,
                    inst_df[feature].values,
                    inst_dir / f"{feature}.day.bin",
                    calendars
                )
    
    def _save_bin_file(self, dates, values, output_path, all_calendars):
        """ä¿å­˜ä¸ºQlib binæ ¼å¼"""
        # åˆ›å»ºå®Œæ•´çš„æ—¥æœŸåºåˆ—
        df = pd.DataFrame({'date': dates, 'value': values})
        df['date'] = pd.to_datetime(df['date'])
        df = df.set_index('date')
        
        # é‡ç´¢å¼•åˆ°å®Œæ•´æ—¥å†
        full_dates = pd.to_datetime(all_calendars)
        df = df.reindex(full_dates)
        
        # å‰å‘å¡«å……ç¼ºå¤±å€¼
        df = df.fillna(method='ffill')
        
        # è·å–èµ·å§‹ç´¢å¼•
        start_index = 0
        
        # ä¿å­˜ä¸ºäºŒè¿›åˆ¶æ ¼å¼
        data = np.hstack([start_index, df['value'].values]).astype('<f')
        data.tofile(str(output_path))
    
    def create_hdf5(self, df):
        """åˆ›å»ºHDF5æ ¼å¼æ–‡ä»¶"""
        self.h5_dir.mkdir(parents=True, exist_ok=True)
        
        # è½¬æ¢ä¸ºMultiIndexæ ¼å¼
        df['datetime'] = pd.to_datetime(df['datetime'])
        df = df.set_index(['datetime', 'instrument'])
        df = df.sort_index()
        
        # é€‰æ‹©éœ€è¦çš„åˆ—
        df = df[['open', 'high', 'low', 'close', 'volume']]
        
        # ä¿å­˜ä¸ºHDF5
        h5_file = self.h5_dir / "daily_pv.h5"
        df.to_hdf(h5_file, key='data', mode='w')
        print(f"  ç”ŸæˆHDF5æ–‡ä»¶: {h5_file}")
        print(f"  æ•°æ®å½¢çŠ¶: {df.shape}")
    
    def verify_conversion(self):
        """éªŒè¯è½¬æ¢ç»“æœ"""
        # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
        checks = {
            "æ—¥å†æ–‡ä»¶": self.qlib_dir / "calendars/day.txt",
            "è‚¡ç¥¨åˆ—è¡¨": self.qlib_dir / "instruments/all.txt",
            "HDF5æ•°æ®": self.h5_dir / "daily_pv.h5"
        }
        
        all_good = True
        for name, path in checks.items():
            if path.exists():
                print(f"  âœ… {name}: {path}")
            else:
                print(f"  âŒ {name}: æœªæ‰¾åˆ°")
                all_good = False
        
        # æ£€æŸ¥ç‰¹å¾æ–‡ä»¶æ•°é‡
        features_dir = self.qlib_dir / "features"
        etf_count = len(list(features_dir.iterdir()))
        print(f"  ğŸ“ ç‰¹å¾ç›®å½•: {etf_count} ä¸ªETF")
        
        return all_good

def main():
    """ä¸»å‡½æ•°"""
    import argparse
    
    parser = argparse.ArgumentParser(description='ETFæ•°æ®å‡†å¤‡å·¥å…·')
    parser.add_argument('--input', required=True, help='è¾“å…¥CSVæ–‡ä»¶æˆ–ç›®å½•')
    parser.add_argument('--output', required=True, help='è¾“å‡ºç›®å½•')
    
    args = parser.parse_args()
    
    preparer = ETFDataPreparer(args.input, args.output)
    preparer.prepare()

if __name__ == "__main__":
    main()
```

ä½¿ç”¨ç¤ºä¾‹ï¼š
```bash
# å•ä¸ªCSVæ–‡ä»¶
python prepare_etf_data.py --input etf_data.csv --output ./data

# å¤šä¸ªCSVæ–‡ä»¶ç›®å½•
python prepare_etf_data.py --input ./csv_files --output ./data
```

---

## âš™ï¸ ç¬¬äº”éƒ¨åˆ†ï¼šé…ç½®ä¿®æ”¹

### æ ¸å¿ƒé…ç½®æ–‡ä»¶æ¸…å•

| é…ç½®æ–‡ä»¶ | ä½œç”¨ | å¿…æ”¹é¡¹ |
|---------|------|--------|
| `.env` | APIå¯†é’¥å’Œç¯å¢ƒå˜é‡ | OPENAI_API_KEY |
| `rdagent/components/coder/factor_coder/config.py` | æ•°æ®è·¯å¾„é…ç½® | ç¬¬11, 15è¡Œ |
| `rdagent/scenarios/qlib/experiment/factor_template/*.yaml` | å›æµ‹å‚æ•° | ç¬¬4, 9, 10è¡Œ |

### é…ç½®ç”Ÿæˆå™¨

åˆ›å»º `config_generator.py`ï¼š

```python
#!/usr/bin/env python
"""
RD-Agenté…ç½®ç”Ÿæˆå™¨
äº¤äº’å¼ç”Ÿæˆæ‰€æœ‰å¿…éœ€çš„é…ç½®æ–‡ä»¶
"""

import os
import yaml
import json
from pathlib import Path

class ConfigGenerator:
    def __init__(self):
        self.config = {}
        self.project_root = Path.cwd()
        
    def run(self):
        """è¿è¡Œäº¤äº’å¼é…ç½®ç”Ÿæˆ"""
        print("========================================")
        print("   RD-Agent é…ç½®ç”Ÿæˆå™¨")
        print("========================================")
        print()
        
        # 1. APIé…ç½®
        self.configure_api()
        
        # 2. æ•°æ®è·¯å¾„é…ç½®
        self.configure_data_paths()
        
        # 3. å¸‚åœºé…ç½®
        self.configure_market()
        
        # 4. ç”Ÿæˆé…ç½®æ–‡ä»¶
        self.generate_configs()
        
        print("\nâœ… é…ç½®ç”Ÿæˆå®Œæˆï¼")
        
    def configure_api(self):
        """é…ç½®APIå¯†é’¥"""
        print("1. APIé…ç½®")
        print("-" * 40)
        
        api_key = input("è¯·è¾“å…¥OpenAI APIå¯†é’¥: ").strip()
        api_base = input("APIåŸºç¡€URL [é»˜è®¤: https://api.openai.com/v1]: ").strip()
        
        if not api_base:
            api_base = "https://api.openai.com/v1"
        
        self.config['api'] = {
            'OPENAI_API_KEY': api_key,
            'OPENAI_API_BASE': api_base,
            'CHAT_MODEL': 'gpt-4o',
            'EMBEDDING_MODEL': 'text-embedding-3-small'
        }
        
    def configure_data_paths(self):
        """é…ç½®æ•°æ®è·¯å¾„"""
        print("\n2. æ•°æ®è·¯å¾„é…ç½®")
        print("-" * 40)
        
        default_qlib = str(self.project_root / "data/qlib_etf_data_final")
        default_h5 = str(self.project_root / "data/qlib_etf_data_h5")
        
        qlib_path = input(f"Qlibæ•°æ®è·¯å¾„ [{default_qlib}]: ").strip()
        h5_path = input(f"HDF5æ•°æ®è·¯å¾„ [{default_h5}]: ").strip()
        
        if not qlib_path:
            qlib_path = default_qlib
        if not h5_path:
            h5_path = default_h5
            
        self.config['data'] = {
            'qlib_path': qlib_path,
            'h5_path': h5_path
        }
        
    def configure_market(self):
        """é…ç½®å¸‚åœºå‚æ•°"""
        print("\n3. å¸‚åœºé…ç½®")
        print("-" * 40)
        
        market = input("å¸‚åœºèŒƒå›´ [all]: ").strip() or "all"
        benchmark = input("åŸºå‡†æŒ‡æ•° [000852.csi]: ").strip() or "000852.csi"
        
        start_date = input("å›æµ‹å¼€å§‹æ—¥æœŸ [2023-01-01]: ").strip() or "2023-01-01"
        end_date = input("å›æµ‹ç»“æŸæ—¥æœŸ [2025-07-10]: ").strip() or "2025-07-10"
        
        self.config['market'] = {
            'market': market,
            'benchmark': benchmark,
            'start_date': start_date,
            'end_date': end_date
        }
        
    def generate_configs(self):
        """ç”Ÿæˆé…ç½®æ–‡ä»¶"""
        print("\nç”Ÿæˆé…ç½®æ–‡ä»¶...")
        
        # 1. ç”Ÿæˆ.envæ–‡ä»¶
        self._generate_env_file()
        
        # 2. æ›´æ–°Pythoné…ç½®
        self._update_python_config()
        
        # 3. æ›´æ–°YAMLé…ç½®
        self._update_yaml_configs()
        
    def _generate_env_file(self):
        """ç”Ÿæˆ.envæ–‡ä»¶"""
        env_content = f"""# RD-Agenté…ç½®æ–‡ä»¶
# è‡ªåŠ¨ç”Ÿæˆï¼Œè¯·å‹¿æ‰‹åŠ¨ä¿®æ”¹

# APIé…ç½®
OPENAI_API_KEY={self.config['api']['OPENAI_API_KEY']}
OPENAI_API_BASE={self.config['api']['OPENAI_API_BASE']}
CHAT_MODEL={self.config['api']['CHAT_MODEL']}
EMBEDDING_MODEL={self.config['api']['EMBEDDING_MODEL']}

# æ•°æ®è·¯å¾„
QLIB_DATA_PATH={self.config['data']['qlib_path']}
HDF5_DATA_PATH={self.config['data']['h5_path']}

# å¸‚åœºé…ç½®
MARKET={self.config['market']['market']}
BENCHMARK={self.config['market']['benchmark']}
"""
        
        with open('.env', 'w') as f:
            f.write(env_content)
        print("  âœ… ç”Ÿæˆ .env")
        
    def _update_python_config(self):
        """æ›´æ–°Pythoné…ç½®æ–‡ä»¶"""
        config_file = Path("rdagent/components/coder/factor_coder/config.py")
        
        if config_file.exists():
            # è¯»å–æ–‡ä»¶
            with open(config_file, 'r') as f:
                lines = f.readlines()
            
            # æ›´æ–°æ•°æ®è·¯å¾„
            for i, line in enumerate(lines):
                if 'data_folder:' in line and 'git_ignore_folder' in line:
                    lines[i] = f'    data_folder: str = "{self.config["data"]["h5_path"]}"\n'
                elif 'data_folder_debug:' in line and 'git_ignore_folder' in line:
                    lines[i] = f'    data_folder_debug: str = "{self.config["data"]["h5_path"]}"\n'
            
            # å†™å›æ–‡ä»¶
            with open(config_file, 'w') as f:
                f.writelines(lines)
            print("  âœ… æ›´æ–° config.py")
        
    def _update_yaml_configs(self):
        """æ›´æ–°YAMLé…ç½®æ–‡ä»¶"""
        yaml_dir = Path("rdagent/scenarios/qlib/experiment/factor_template")
        
        if yaml_dir.exists():
            for yaml_file in yaml_dir.glob("*.yaml"):
                self._update_single_yaml(yaml_file)
        
    def _update_single_yaml(self, yaml_file):
        """æ›´æ–°å•ä¸ªYAMLæ–‡ä»¶"""
        with open(yaml_file, 'r') as f:
            config = yaml.safe_load(f)
        
        # æ›´æ–°é…ç½®
        if 'qlib_init' in config:
            config['qlib_init']['provider_uri'] = self.config['data']['qlib_path']
        
        if 'market' in self.config['market']:
            # ä½¿ç”¨YAMLé”šç‚¹å¼•ç”¨
            for key in config:
                if isinstance(config[key], str) and 'market' in config[key]:
                    config[key] = self.config['market']['market']
        
        # å†™å›æ–‡ä»¶
        with open(yaml_file, 'w') as f:
            yaml.dump(config, f, default_flow_style=False)
        
        print(f"  âœ… æ›´æ–° {yaml_file.name}")

def main():
    generator = ConfigGenerator()
    generator.run()

if __name__ == "__main__":
    main()
```

---

## ğŸƒ ç¬¬å…­éƒ¨åˆ†ï¼šè¿è¡ŒéªŒè¯

### å¥åº·æ£€æŸ¥

```bash
# åŸºç¡€å¥åº·æ£€æŸ¥
rdagent health_check

# è¯¦ç»†è¯Šæ–­
python diagnostic_tool.py
```

åˆ›å»º `diagnostic_tool.py`ï¼š

```python
#!/usr/bin/env python
"""
RD-Agentè¯Šæ–­å·¥å…·
æ£€æŸ¥ç³»ç»Ÿé…ç½®å’Œæ•°æ®å®Œæ•´æ€§
"""

import os
import sys
from pathlib import Path
import pandas as pd
import yaml

class DiagnosticTool:
    def __init__(self):
        self.checks_passed = 0
        self.checks_failed = 0
        
    def run(self):
        """è¿è¡Œæ‰€æœ‰è¯Šæ–­æ£€æŸ¥"""
        print("========================================")
        print("   RD-Agent ç³»ç»Ÿè¯Šæ–­")
        print("========================================\n")
        
        # 1. æ£€æŸ¥Pythonç¯å¢ƒ
        self.check_python_env()
        
        # 2. æ£€æŸ¥é…ç½®æ–‡ä»¶
        self.check_configs()
        
        # 3. æ£€æŸ¥æ•°æ®æ–‡ä»¶
        self.check_data_files()
        
        # 4. æ£€æŸ¥ä¾èµ–åŒ…
        self.check_dependencies()
        
        # 5. è¿è¡Œæµ‹è¯•å› å­
        self.test_factor_generation()
        
        # æ€»ç»“
        self.print_summary()
        
    def check_python_env(self):
        """æ£€æŸ¥Pythonç¯å¢ƒ"""
        print("1. Pythonç¯å¢ƒæ£€æŸ¥")
        print("-" * 40)
        
        # Pythonç‰ˆæœ¬
        python_version = f"{sys.version_info.major}.{sys.version_info.minor}.{sys.version_info.micro}"
        self._check("Pythonç‰ˆæœ¬", python_version, 
                   sys.version_info.major == 3 and sys.version_info.minor == 10)
        
        # è™šæ‹Ÿç¯å¢ƒ
        in_venv = hasattr(sys, 'real_prefix') or (
            hasattr(sys, 'base_prefix') and sys.base_prefix != sys.prefix
        )
        self._check("è™šæ‹Ÿç¯å¢ƒ", "å·²æ¿€æ´»" if in_venv else "æœªæ¿€æ´»", in_venv)
        
        print()
        
    def check_configs(self):
        """æ£€æŸ¥é…ç½®æ–‡ä»¶"""
        print("2. é…ç½®æ–‡ä»¶æ£€æŸ¥")
        print("-" * 40)
        
        # .envæ–‡ä»¶
        env_exists = Path('.env').exists()
        self._check(".envæ–‡ä»¶", "å­˜åœ¨" if env_exists else "ä¸å­˜åœ¨", env_exists)
        
        if env_exists:
            with open('.env', 'r') as f:
                env_content = f.read()
                has_api_key = 'OPENAI_API_KEY=' in env_content and \
                             'your_api_key_here' not in env_content
                self._check("APIå¯†é’¥é…ç½®", "å·²è®¾ç½®" if has_api_key else "æœªè®¾ç½®", has_api_key)
        
        # æ£€æŸ¥å…³é”®é…ç½®æ–‡ä»¶
        config_files = [
            "rdagent/components/coder/factor_coder/config.py",
            "rdagent/scenarios/qlib/experiment/factor_template/conf_baseline.yaml"
        ]
        
        for config_file in config_files:
            exists = Path(config_file).exists()
            self._check(f"{Path(config_file).name}", "å­˜åœ¨" if exists else "ä¸å­˜åœ¨", exists)
        
        print()
        
    def check_data_files(self):
        """æ£€æŸ¥æ•°æ®æ–‡ä»¶"""
        print("3. æ•°æ®æ–‡ä»¶æ£€æŸ¥")
        print("-" * 40)
        
        # ä».envè¯»å–è·¯å¾„
        data_paths = self._get_data_paths()
        
        # æ£€æŸ¥Qlibæ•°æ®
        if data_paths['qlib_path']:
            qlib_path = Path(data_paths['qlib_path'])
            if qlib_path.exists():
                calendars = qlib_path / "calendars/day.txt"
                instruments = qlib_path / "instruments/all.txt"
                features = qlib_path / "features"
                
                self._check("Qlibæ—¥å†æ–‡ä»¶", "å­˜åœ¨" if calendars.exists() else "ä¸å­˜åœ¨", calendars.exists())
                self._check("Qlibè‚¡ç¥¨åˆ—è¡¨", "å­˜åœ¨" if instruments.exists() else "ä¸å­˜åœ¨", instruments.exists())
                
                if features.exists():
                    etf_count = len(list(features.iterdir()))
                    self._check("ETFæ•°æ®", f"{etf_count}ä¸ª", etf_count > 0)
        
        # æ£€æŸ¥HDF5æ•°æ®
        if data_paths['h5_path']:
            h5_path = Path(data_paths['h5_path'])
            if h5_path.exists():
                h5_file = h5_path / "daily_pv.h5"
                self._check("HDF5æ•°æ®æ–‡ä»¶", "å­˜åœ¨" if h5_file.exists() else "ä¸å­˜åœ¨", h5_file.exists())
                
                if h5_file.exists():
                    try:
                        df = pd.read_hdf(h5_file, key='data')
                        self._check("HDF5æ•°æ®è¯»å–", f"æˆåŠŸ ({df.shape[0]}æ¡è®°å½•)", True)
                    except Exception as e:
                        self._check("HDF5æ•°æ®è¯»å–", f"å¤±è´¥: {str(e)}", False)
        
        print()
        
    def check_dependencies(self):
        """æ£€æŸ¥ä¾èµ–åŒ…"""
        print("4. ä¾èµ–åŒ…æ£€æŸ¥")
        print("-" * 40)
        
        packages = ['rdagent', 'qlib', 'pandas', 'numpy', 'pyyaml']
        
        for package in packages:
            try:
                __import__(package)
                self._check(f"{package}", "å·²å®‰è£…", True)
            except ImportError:
                self._check(f"{package}", "æœªå®‰è£…", False)
        
        print()
        
    def test_factor_generation(self):
        """æµ‹è¯•å› å­ç”Ÿæˆ"""
        print("5. å› å­ç”Ÿæˆæµ‹è¯•")
        print("-" * 40)
        
        # åˆ›å»ºæµ‹è¯•å› å­ä»£ç 
        test_factor = """
import pandas as pd
import numpy as np

# æµ‹è¯•èƒ½å¦è¯»å–æ•°æ®
try:
    data = pd.read_hdf('daily_pv.h5', key='data')
    print(f"æ•°æ®è¯»å–æˆåŠŸ: {data.shape}")
    
    # è®¡ç®—ç®€å•å› å­
    factor = data['close'].pct_change()
    print(f"å› å­è®¡ç®—æˆåŠŸ: {factor.shape}")
    
    success = True
except Exception as e:
    print(f"æµ‹è¯•å¤±è´¥: {e}")
    success = False
"""
        
        # è¿™é‡Œåªæ˜¯æ¨¡æ‹Ÿï¼Œå®é™…è¿è¡Œéœ€è¦åœ¨æ­£ç¡®çš„ç¯å¢ƒä¸­
        self._check("å› å­ç”Ÿæˆæµ‹è¯•", "è·³è¿‡ï¼ˆéœ€æ‰‹åŠ¨æµ‹è¯•ï¼‰", None)
        
        print()
        
    def _check(self, name, status, passed):
        """æ‰§è¡Œå•ä¸ªæ£€æŸ¥"""
        if passed is None:
            symbol = "âš ï¸"
            color = "\033[93m"  # é»„è‰²
        elif passed:
            symbol = "âœ…"
            color = "\033[92m"  # ç»¿è‰²
            self.checks_passed += 1
        else:
            symbol = "âŒ"
            color = "\033[91m"  # çº¢è‰²
            self.checks_failed += 1
        
        reset = "\033[0m"
        print(f"  {symbol} {name}: {color}{status}{reset}")
        
    def _get_data_paths(self):
        """ä»é…ç½®è·å–æ•°æ®è·¯å¾„"""
        paths = {'qlib_path': None, 'h5_path': None}
        
        if Path('.env').exists():
            with open('.env', 'r') as f:
                for line in f:
                    if 'QLIB_DATA_PATH=' in line:
                        paths['qlib_path'] = line.split('=')[1].strip()
                    elif 'HDF5_DATA_PATH=' in line:
                        paths['h5_path'] = line.split('=')[1].strip()
        
        return paths
        
    def print_summary(self):
        """æ‰“å°è¯Šæ–­æ€»ç»“"""
        print("========================================")
        print("è¯Šæ–­æ€»ç»“")
        print("========================================")
        
        total = self.checks_passed + self.checks_failed
        if total > 0:
            success_rate = (self.checks_passed / total) * 100
            print(f"âœ… é€šè¿‡: {self.checks_passed}")
            print(f"âŒ å¤±è´¥: {self.checks_failed}")
            print(f"ğŸ“Š æˆåŠŸç‡: {success_rate:.1f}%")
            
            if success_rate == 100:
                print("\nğŸ‰ ç³»ç»ŸçŠ¶æ€è‰¯å¥½ï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨ï¼")
            elif success_rate >= 80:
                print("\nâš ï¸ ç³»ç»ŸåŸºæœ¬å°±ç»ªï¼Œä½†å»ºè®®ä¿®å¤å¤±è´¥é¡¹")
            else:
                print("\nâŒ ç³»ç»Ÿå­˜åœ¨é—®é¢˜ï¼Œè¯·å…ˆä¿®å¤å¤±è´¥é¡¹")
        
        print("\nä¸‹ä¸€æ­¥ï¼š")
        if self.checks_failed > 0:
            print("1. ä¿®å¤æ‰€æœ‰æ ‡è®°ä¸º âŒ çš„é¡¹ç›®")
            print("2. é‡æ–°è¿è¡Œè¯Šæ–­å·¥å…·")
        else:
            print("1. è¿è¡Œ: rdagent fin_factor --loop_n 1")
            print("2. æŸ¥çœ‹ç»“æœ: rdagent ui --port 19899")

def main():
    tool = DiagnosticTool()
    tool.run()

if __name__ == "__main__":
    main()
```

### é¦–æ¬¡æµ‹è¯•è¿è¡Œ

```bash
# 1. ç®€å•æµ‹è¯•ï¼ˆ1ä¸ªå› å­ï¼Œ1è½®è¿­ä»£ï¼‰
rdagent fin_factor --loop_n 1 --step_n 1

# 2. æŸ¥çœ‹è¿è¡Œæ—¥å¿—
tail -f log/latest/run.log

# 3. æ£€æŸ¥ç»“æœ
python check_results.py
```

---

## ğŸ”§ ç¬¬ä¸ƒéƒ¨åˆ†ï¼šé—®é¢˜æ’æŸ¥

### å¸¸è§é—®é¢˜é€ŸæŸ¥è¡¨

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| timeout: command not found | macOSç¼ºå°‘GNUå·¥å…· | `brew install coreutils` |
| ICå€¼å…¨éƒ¨ç›¸åŒ(0.007418) | æ–‡ä»¶æ ¼å¼ä¸å…¼å®¹ | å°†.parquetæ”¹ä¸º.pkl |
| KeyError: 'label' | é…ç½®æ–‡ä»¶é”™è¯¯ | æ£€æŸ¥YAMLé…ç½®ä¸­çš„labelå­—æ®µ |
| No module named 'qlib' | Qlibæœªå®‰è£… | `pip install qlib` |
| Docker permission denied | Dockeræƒé™é—®é¢˜ | å°†ç”¨æˆ·åŠ å…¥dockerç»„ |
| å†…å­˜æº¢å‡º | æ•°æ®é‡è¿‡å¤§ | å‡å°‘batch_sizeæˆ–ä½¿ç”¨åˆ†æ‰¹å¤„ç† |

### è¯¦ç»†è§£å†³æ–¹æ¡ˆ

#### é—®é¢˜1ï¼šmacOS timeoutå‘½ä»¤

```python
# è‡ªåŠ¨ä¿®å¤è„šæœ¬ fix_macos_timeout.py
import fileinput
import sys

file_path = "rdagent/utils/env.py"
for line in fileinput.input(file_path, inplace=True):
    if "timeout --kill-after" in line:
        # æ›¿æ¢ä¸ºå…¼å®¹ç‰ˆæœ¬
        new_line = line.replace(
            "timeout --kill-after=10",
            "if command -v timeout >/dev/null 2>&1; then timeout --kill-after=10"
        )
        print(new_line, end='')
    else:
        print(line, end='')

print("âœ… macOS timeouté—®é¢˜å·²ä¿®å¤")
```

#### é—®é¢˜2ï¼šICå€¼ç›¸åŒé—®é¢˜

```python
# ä¿®å¤æ–‡ä»¶æ ¼å¼ fix_file_format.py
import pandas as pd
from pathlib import Path

def convert_parquet_to_pkl():
    """å°†æ‰€æœ‰.parquetæ–‡ä»¶è½¬æ¢ä¸º.pkl"""
    workspace_dir = Path("git_ignore_folder/RD-Agent_workspace")
    
    for parquet_file in workspace_dir.rglob("*.parquet"):
        try:
            # è¯»å–parquet
            df = pd.read_parquet(parquet_file)
            
            # ä¿å­˜ä¸ºpkl
            pkl_file = parquet_file.with_suffix('.pkl')
            df.to_pickle(pkl_file)
            
            # åˆ é™¤åŸæ–‡ä»¶
            parquet_file.unlink()
            
            print(f"âœ… è½¬æ¢: {parquet_file.name} â†’ {pkl_file.name}")
        except Exception as e:
            print(f"âŒ å¤±è´¥: {parquet_file.name}: {e}")

if __name__ == "__main__":
    convert_parquet_to_pkl()
```

---

## ğŸ“š é™„å½•Aï¼šå‘½ä»¤é€ŸæŸ¥è¡¨

```bash
# ç¯å¢ƒç®¡ç†
conda create -n rdagent python=3.10.18    # åˆ›å»ºç¯å¢ƒ
conda activate rdagent                    # æ¿€æ´»ç¯å¢ƒ
conda deactivate                          # é€€å‡ºç¯å¢ƒ

# å®‰è£…ç›¸å…³
pip install -e .                          # å¼€å‘æ¨¡å¼å®‰è£…
pip install qlib                          # å®‰è£…Qlib

# RD-Agentå‘½ä»¤
rdagent health_check                      # å¥åº·æ£€æŸ¥
rdagent fin_factor --loop_n 5             # è¿è¡Œ5è½®å› å­æŒ–æ˜
rdagent ui --port 19899                   # å¯åŠ¨Webç•Œé¢

# æ•°æ®å‡†å¤‡
python prepare_etf_data.py --input data.csv --output ./data
python scripts/dump_bin.py dump_all --csv_path ./csv --qlib_dir ./qlib_data

# è¯Šæ–­å·¥å…·
python check_environment.sh               # ç¯å¢ƒæ£€æŸ¥
python diagnostic_tool.py                 # ç³»ç»Ÿè¯Šæ–­
python config_generator.py                # é…ç½®ç”Ÿæˆ

# Dockerç›¸å…³
docker build -t rdagent-etf .            # æ„å»ºé•œåƒ
docker run -it rdagent-etf               # è¿è¡Œå®¹å™¨
docker ps                                 # æŸ¥çœ‹è¿è¡Œå®¹å™¨
docker logs <container_id>               # æŸ¥çœ‹æ—¥å¿—
```

---

## ğŸ“š é™„å½•Bï¼šé¡¹ç›®ç»“æ„è¯´æ˜

```
RD-Agent/
â”œâ”€â”€ rdagent/                    # æ ¸å¿ƒä»£ç 
â”‚   â”œâ”€â”€ components/             # ç»„ä»¶æ¨¡å—
â”‚   â”‚   â””â”€â”€ coder/             
â”‚   â”‚       â””â”€â”€ factor_coder/   # å› å­ç”Ÿæˆå™¨
â”‚   â”‚           â””â”€â”€ config.py   # âš™ï¸ éœ€è¦ä¿®æ”¹ï¼šæ•°æ®è·¯å¾„
â”‚   â”œâ”€â”€ scenarios/              # åœºæ™¯å®ç°
â”‚   â”‚   â””â”€â”€ qlib/              
â”‚   â”‚       â”œâ”€â”€ experiment/     # å®éªŒé…ç½®
â”‚   â”‚       â”‚   â””â”€â”€ factor_template/  # âš™ï¸ éœ€è¦ä¿®æ”¹ï¼šYAMLé…ç½®
â”‚   â”‚       â””â”€â”€ developer/      # å¼€å‘è€…å·¥å…·
â”‚   â””â”€â”€ utils/                  
â”‚       â””â”€â”€ env.py              # âš™ï¸ macOSéœ€è¦ä¿®æ”¹ï¼štimeoutå‘½ä»¤
â”œâ”€â”€ data/                       # æ•°æ®ç›®å½•ï¼ˆéœ€åˆ›å»ºï¼‰
â”‚   â”œâ”€â”€ qlib_etf_data_final/   # Qlibæ ¼å¼æ•°æ®
â”‚   â”‚   â”œâ”€â”€ calendars/          # äº¤æ˜“æ—¥å†
â”‚   â”‚   â”œâ”€â”€ features/           # ç‰¹å¾æ•°æ®(.binæ–‡ä»¶)
â”‚   â”‚   â””â”€â”€ instruments/        # è‚¡ç¥¨åˆ—è¡¨
â”‚   â””â”€â”€ qlib_etf_data_h5/      # HDF5æ ¼å¼æ•°æ®
â”‚       â””â”€â”€ daily_pv.h5         # ä»·é‡æ•°æ®
â”œâ”€â”€ git_ignore_folder/          # å·¥ä½œç›®å½•ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚   â””â”€â”€ RD-Agent_workspace/     # å®éªŒå·¥ä½œç©ºé—´
â”œâ”€â”€ log/                        # æ—¥å¿—ç›®å½•ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”œâ”€â”€ .env                        # âš™ï¸ éœ€è¦åˆ›å»ºï¼šç¯å¢ƒå˜é‡
â””â”€â”€ scripts/                    # å·¥å…·è„šæœ¬
    â”œâ”€â”€ quick_install.sh        # ä¸€é”®å®‰è£…
    â”œâ”€â”€ prepare_etf_data.py     # æ•°æ®å‡†å¤‡
    â””â”€â”€ diagnostic_tool.py      # è¯Šæ–­å·¥å…·
```

---

## ğŸ“ å­¦ä¹ èµ„æº

- [RD-Agentå®˜æ–¹ä»“åº“](https://github.com/microsoft/RD-Agent)
- [Qlibå®˜æ–¹æ–‡æ¡£](https://qlib.readthedocs.io/)
- [è®ºæ–‡ï¼šR&D-Agent-Quant](https://arxiv.org/abs/2505.15155)
- [è§†é¢‘æ•™ç¨‹](å¾…åˆ›å»º)

---

## ğŸ“ è·å–å¸®åŠ©

é‡åˆ°é—®é¢˜æ—¶çš„è§£å†³æ­¥éª¤ï¼š

1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„é—®é¢˜æ’æŸ¥ç« èŠ‚
2. è¿è¡Œè¯Šæ–­å·¥å…·ï¼š`python diagnostic_tool.py`
3. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼š`log/latest/run.log`
4. æœç´¢GitHub Issues
5. æäº¤æ–°Issueï¼ˆåŒ…å«è¯Šæ–­ç»“æœï¼‰

---

*æ–‡æ¡£ç‰ˆæœ¬ï¼š1.0.0 | æœ€åæ›´æ–°ï¼š2025-08-08*